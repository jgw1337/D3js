<!DOCTYPE html>
<html lang="en">

<head>
  <title>Learning D3</title>
  <link rel="stylesheet" href="main.css">
  <script src="d3.min.js"></script>
</head>

<body>
  <script>
    var data = [
      { key: "Glazed",    value: "132" },
      { key: "Jelly",     value: "71" },
      { key: "Holes",     value: "337" },
      { key: "Sprinkles", value: "93" },
      { key: "Crumb",     value: "78" },
      { key: "Chocolate", value: "43" },
      { key: "Coconut",   value: "20" },
      { key: "Cream",     value: "16" },
      { key: "Cruller",   value: "30" },
      { key: "Ã‰clair",    value: "8" },
      { key: "Fritter",   value: "17" },
      { key: "Bearclaw",  value: "21" }
    ];
    var w = 800;
    var h = 450;
    var margin = {
      top: 58,
      left: 60,
      right: 40,
      bottom: 72
    };
    var width = w - margin.left - margin.right;
    var height = h - margin.top - margin.bottom;
    var x = d3.scaleBand()
    .domain(data.map(function(item) {
      return item.key;
    }))
    .range([0, width]);
    var y = d3.scaleLinear()
      .domain([0, d3.max(data, function(datum) {
        return datum.value;
      })])
      .range([height, 0]);

    var linearColorScale = d3.scaleLinear()
                             .domain([1, data.length])
                             .range(["#572500", "#F68026"]);
    var ordinalColorScale = d3.scaleOrdinal(d3.schemeCategory20);

    var xAxis = d3.axisBottom()
                  .scale(x);
    var yAxis = d3.axisLeft()
                  .scale(y);
    var yGridlines = d3.axisLeft()
                       .scale(y)
                       .tickSize(-width, 0, 0)
                       .tickFormat("");

    var svg = d3.select("body").append("svg")
      .attr("id", "chart")
      .attr("width", w)
      .attr("height", h);
    var barChart = svg.append("g")
                      .classed("display", true)
                      .attr("transform", "translate(" + margin.left + ", " + margin.top + ")");

    function plot(params) {
      this.append("g")
          .call(yGridlines)
          .classed("gridline", true)
          .attr("transform", "translate(0,0)");
      this.selectAll(".bar")
        .data(params.data)
        .enter()
        .append("rect")
        .classed("bar", true)
        .attr("x", function(datum, idx) {
          return x(datum.key);
        })
        .attr("y", function (datum, idx) {
          return y(datum.value);
        })
        .attr("width", function (datum, idx) {
          console.log(datum.value, x(datum.value));
          return x.bandwidth();
        })
        .attr("height", function(datum, idx) {
          return height - y(datum.value);
        })
        .style("fill", function(datum, idx) {
          return ordinalColorScale(idx);
          // return linearColorScale(idx);
        });
      this.selectAll(".col-label")
        .data(params.data)
        .enter()
        .append("text")
        .classed("col-label", true)
        .attr("x", function (datum, idx) {
          return x(datum.key) + (x.bandwidth()/2);
        })
        .attr("y", function (datum, idx) {
          return y(datum.value);
        })
        .attr("dy", -6)
        .text(function (datum, idx) {
          return datum.value;
        });

      this.append("g")
          .classed("x axis", true)
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis)
              .selectAll("text")
                  .style("text-anchor", "end")
                  .attr("dx", -8)
                  .attr("dy", 8)
                  .attr("transform", "translate(0,0) rotate(-45)");

      this.append("g")
          .classed("y axis", true)
          .attr("transform", "translate(0,0)")
          .call(yAxis);
    }

    plot.call(
      barChart,
      {
        data: data
      }
    );
  </script>
</body>

</html>